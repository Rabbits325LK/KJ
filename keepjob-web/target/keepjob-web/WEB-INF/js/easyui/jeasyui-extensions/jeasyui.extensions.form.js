(function(g,d){g.fn.form.extensions={};function h(q,r){if(!r){var n=g(q),p=g.data(q,"form"),o=p?p.options:g.fn.form.defaults;r=o.serializer}return g(q).serializeObject(r)}var a=g.fn.form.methods.submit;function k(u,y){var x=g(u),o=g.data(u,"form"),v=(/^(?:form)$/i.test(u.nodeName)&&o)?true:false,n=g.extend({},(o?o.options:g.fn.form.defaults),(typeof y=="string")?{url:y}:(g.isFunction(y)?{success:y}:y||{})),r=function(){if(n.showLoading){g.easyui.loading({msg:n.loadingMessage,locale:n.loadingLocale})}},s=function(){if(n.showLoading){if(n.loadedDelay){g.util.exec(function(){g.easyui.loaded(n.loadingLocale)},n.loadedDelay)}else{g.easyui.loaded(n.loadingLocale)}}};if(!n.url){n.url=window.location.href}if(v){return a.call(x,x,n)}var q=x.form("getData");if(g.isFunction(n.onSubmit)&&n.onSubmit.call(u,q)==false){return s()}var w=g.ajaxSettings.beforeSend,p=g.ajaxSettings.complete;g.ajax({url:n.url,type:n.method,data:q,success:function(t){if(g.isFunction(n.success)){return n.success.call(u,t)}},beforeSend:function(){var t=g.isFunction(w)?w.apply(this,arguments):d;r();return t},complete:function(){var t=g.isFunction(p)?p.apply(this,arguments):d;s();return t}})}function m(r,q){if(!g.data(r,"form")){g.data(r,"form",{options:g.extend({},g.fn.form.defaults)})}var v=g(r),n=g.data(r,"form").options;if(typeof q=="string"){var o={};if(n.onBeforeLoad.call(r,o)==false){return}g.ajax({url:q,data:o,dataType:"json",type:n.method,success:function(t){s(t)},error:function(){n.onLoadError.apply(r,arguments)}})}else{s(q)}function s(z){for(var x in z){var A=z[x];var t=u(x,A);if(!t.length){var y=p(x,A);if(!y){g.each(g.fn.form.valueMarkList,function(B,C){g(C+'[name="'+x+'"]',v).val(A)});g.each(g.fn.form.textMarkList,function(B,C){g(C+'[name="'+x+'"]',v).text(A)})}}w(x,A)}n.onLoadSuccess.call(r,z);v.form("validate")}function u(x,y){var t=v.find('input[name="'+x+'"][type=radio], input[name="'+x+'"][type=checkbox]');t._propAttr("checked",false);t.each(function(){var z=g(this);if(z.val()==String(y)||g.inArray(z.val(),g.isArray(y)?y:[y])>=0){z._propAttr("checked",true)}});return t}function p(x,C){var z=0;var t=g.fn.form.otherList;for(var y=0;y<t.length;y++){var B=t[y];var A=v.find("["+B+'Name="'+x+'"]');if(A.length){A[B]("setValue",C);z+=A.length}}return z}function w(t,z){var B=g.fn.form.comboList;var A=v.find('[comboName="'+t+'"]');if(A.length){for(var x=B.length-1;x>=0;x--){var y=B[x];if(A.hasClass(y+"-f")){if(A[y]("options").multiple){A[y]("setValues",z)}else{A[y]("setValue",z)}return}}}}}function i(u){g(g.fn.form.valueMarkList.join(","),u).each(function(){var w=this.type,r=this.tagName.toLowerCase();if(w=="text"||w=="hidden"||w=="password"||r=="textarea"){this.value=""}else{if(w=="file"){var v=g(this),x=v.clone().insertAfter(v).val("");if(v.data("validatebox")){v.validatebox("destroy");x.validatebox()}else{v.remove()}}else{if(w=="checkbox"||w=="radio"){this.checked=false}else{if(r=="select"){this.selectedIndex=-1}}}}});var p=g(u),n=g.array.distinct(g.array.merge([],g.fn.form.otherList,g.fn.form.spinnerList,g.fn.form.comboList));for(var o=0;o<n.length;o++){var s=n[o],q=p.find("."+s+"-f");if(q.length&&g.fn[s]&&g.fn[s]["methods"]){g.util.tryExec(function(){q[s]("clear")})}}p.form("validate")}function j(w){var p=g(w),v=g.data(w,"form"),u=/^(?:form)$/i.test(w.nodeName)&&v?true:false;if(u){w.reset()}var n=g.array.distinct(g.array.merge([],g.fn.form.otherList,g.fn.form.spinnerList,g.fn.form.comboList));for(var o=0;o<n.length;o++){var s=n[o];var q=p.find("."+s+"-f");if(q.length&&g.fn[s]&&g.fn[s]["methods"]){g.util.tryExec(function(){q[s]("reset")})}}p.form("validate")}function l(u){var p=g(u);if(g.fn.validatebox){p.find(".validatebox-text:not(:disabled)").validatebox("validate");var v=p.find(".validatebox-invalid");v.filter(":not(:disabled):first").focus();if(v.length){return false}}var n=g.array.distinct(g.array.merge([],g.fn.form.otherList,g.fn.form.spinnerList,g.fn.form.comboList));for(var o=0;o<n.length;o++){var s=n[o];var q=p.find("."+s+"-f");if(q.length&&g.fn[s]&&g.fn[s]["methods"]){if(g.util.tryExec(function(){return q[s]("isValid")})===false){g.util.tryExec({code:function(){q[s]("focus")},error:function(){q[s]("textbox").focus()},tryError:true});return false}}}return true}function e(v,n){var q=g(v);q.find(".validatebox-text:not(:disabled)").validatebox(n?"disableValidation":"enableValidation");var o=g.array.distinct(g.array.merge([],g.fn.form.otherList,g.fn.form.spinnerList,g.fn.form.comboList));for(var p=0;p<o.length;p++){var u=o[p];var s=q.find("."+u+"-f");if(s.length&&g.fn[u]&&g.fn[u]["methods"]){g.util.tryExec(function(){s[u](n?"disableValidation":"enableValidation")})}}}function b(x,s,v){var y=g(x),o=g.data(x,"form");s=s?true:false;if(o&&o.options){o.disabled=s}var p=v?y.find("input, select, textarea"):y.find("input, select, textarea, button, a.l-btn, .m-btn, .s-btn");if(v){g.each(p,function(r,z){var t=g(z);if(t.is(".s-btn")){t.splitbutton(s?"disable":"enable")}else{if(t.is(".m-btn")){t.menubutton(s?"disable":"enable")}else{if(t.is("a.l-btn")){t.linkbutton(s?"disable":"enable")}else{s?t.attr("disabled",true):t.removeAttr("disabled")}}}})}if(g.fn.validatebox){y.find(".validatebox-text").validatebox(s?"disable":"enable")}var q=g.array.distinct(g.array.merge([],g.fn.form.otherList,g.fn.form.spinnerList,g.fn.form.comboList));for(var u=0;u<q.length;u++){var w=q[u];var n=y.find("."+w+"-f");if(n.length&&g.fn[w]&&g.fn[w]["methods"]){g.util.tryExec(function(){n[w](s?"disable":"enable")})}}}var c=g.fn.form.extensions.methods={getData:function(o,n){return h(o[0],n)},submit:function(o,n){return o.each(function(){k(this,n)})},clear:function(n){return n.each(function(){i(this)})},reset:function(n){return n.each(function(){j(this)})},validate:function(n){return l(n[0])},enableValidation:function(n){return n.each(function(){e(this,false)})},disableValidation:function(n){return n.each(function(){e(this,true)})},enable:function(o,n){return o.each(function(){b(this,false,n)})},disable:function(o,n){return o.each(function(){b(this,true,n)})},load:function(o,n){return o.each(function(){m(this,n)})}};var f=g.fn.form.extensions.defaults={method:"post",showLoading:true,loadingLocale:"body",loadingMessage:"正在将数据发送至服务器...",loadedDelay:300,serializer:{onlyEnabled:true,transcript:"overlay",overtype:"append",separator:","}};g.extend(g.fn.form.defaults,f);g.extend(g.fn.form.methods,c);g.fn.form.comboList=["combo","datebox","datetimebox","combogrid","combotree","combobox"];g.fn.form.spinnerList=["timespinner","numberspinner","spinner"];g.fn.form.valueMarkList=["input","textarea","select"];g.fn.form.textMarkList=["span","label","div","p"];g.fn.form.otherList=["numberbox","slider"]})(jQuery);