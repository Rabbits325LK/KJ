(function(g,h){function e(o){var n=g.data(o,"comboselector"),m=n.options,j=n.idField=m.valueField||m.idField,i=n.valueField=m.valueField||j,k=g(o).addClass("comboselector-f").combo(g.extend({},m,{onShowPanel:function(){k.combo("panel").hide();var r=m.selectorTypes[m.selector];n.dialog=r.method(g.extend({},m,{width:g.isNumeric(m.panelWidth)?m.panelWidth:r.width,height:g.isNumeric(m.panelHeight)?m.panelHeight:r.height,selected:k.combo(m.multiple?"getValues":"getValue"),singleSelect:m.multiple?false:true,idField:j,url:m.url,data:m.data,buttons:[{index:101.5,text:"清除",iconCls:"icon-standard-cancel",handler:function(t){k.combo("clear");t.close()}}],onEnter:function(v){if(v){var t=g.util.likeArrayNotString(v),u=t?g.array.map(v,function(w){return w[j]}):[v[j]];c(o,u)}else{k.combo("clear")}},onClose:function(){var t=g.data(o,"combo");if(t&&t.options){k.combo("hidePanel")}},onLoadSuccess:function(t){n.data=t?(g.util.likeArrayNotString(t)?t:t.rows):[];if(g.isFunction(m.onLoadSuccess)){m.onLoadSuccess.apply(this,arguments)}},onLoadError:function(){g.fn.datagrid.defaults.onLoadError.apply(this,arguments);if(g.isFunction(m.onLoadError)){m.onLoadError.apply(this,arguments)}},onBeforeLoad:function(t){g.fn.datagrid.defaults.onBeforeLoad.apply(this,arguments);if(g.isFunction(m.onBeforeLoad)){m.onBeforeLoad.apply(this,arguments)}}}));var p=n.dialog.dialog("options");if((!g.util.isUtilTop&&!p.topMost)||g.util.isUtilTop){var q=k.combo("textbox"),s=q.offset();n.dialog.dialog("move",g.extend(s,{top:s.top+q.outerHeight()+2}))}if(g.isFunction(m.onShowPanel)){m.onShowPanel.apply(this,arguments)}},onHidePanel:function(){if(n.dialog){var q=n.dialog,p=q.dialog("options");n.dialog=null;if(!p.closed){q.dialog("close")}}if(g.isFunction(m.onHidePanel)){m.onHidePanel.apply(this,arguments)}},onDestroy:function(){if(n.dialog){n.dialog.dialog("destroy");n.dialog=null}if(g.isFunction(m.onDestroy)){m.onDestroy.apply(this,arguments)}},onChange:function(q,p){if(g.isFunction(m.onChange)){m.onChange.apply(this,arguments)}}}));n.data=m.data?m.data:[];m.originalValue=m.value;m.originalText=m.text;if(m.lazyLoad){l()}else{g[m.method](m.url,g.extend({},m.queryParams||{},{page:m.pageNumber||g.fn.datagrid.defaults.pageNumber,rows:m.rows||g.fn.datagrid.defaults.pageSize}),function(p){n.data=p?(g.util.likeArrayNotString(p)?p:p.rows):[];l()})}k.combo("validate");function l(){if(n.data&&n.data.length){if(m.value){c(o,g.util.likeArrayNotString(m.value)?m.value:[m.value])}}else{if(m.text){b(o,m.text)}else{if(m.value){c(o,g.util.likeArrayNotString(m.value)?m.value:[m.value])}}}}}function c(m,n){var q=g(m),j=g.data(m,"comboselector"),i=j.options,l=g.util.likeArrayNotString(n)?n:[n],p=function(r){var s=g.array.first(j.data,function(t){return t[j.idField]==r});return s?s[i.textField]:null},k=g.util.likeArrayNotString(j.data)&&i.textField,o=k?g.array.map(l,function(r){return p(r)}).join(i.separator):g.array.join(l,i.separator);q.combo("setValues",l).combo("setText",o||l.join(i.separator))}function b(i,j){g(i).combo("setText",j).comboselector("options").text=j}function f(k){var i=g(k),j=i.comboselector("options");i.comboselector("setValue",j.originalValue).comboselector("setText",j.originalText)}function a(l,k){var i=g(l),j=g.data(l,"comboselector");if(j.dialog){j.dialog.find(".grid-selector").datagrid("loadData",k)}else{j.data=k}}var d={grid:{method:g.easyui.showGridSelector,width:580,height:360},dblgrid:{method:g.easyui.showDblGridSelector,width:900,height:580},tree:{method:g.easyui.showTreeSelector,width:900,height:580},treegrid:{method:g.easyui.showTreeGridSelector,width:580,height:360},treewithgrid:{method:g.easyui.showTreeWithGridSelector,width:580,height:360}};g.fn.comboselector=function(i,j){if(typeof i=="string"){var k=g.fn.comboselector.methods[i];if(k){return k(this,j)}else{return this.combo(i,j)}}i=i||{};return this.each(function(){var l=g.data(this,"comboselector");if(l){g.extend(l.options,i)}else{g.data(this,"comboselector",{options:g.extend({},g.fn.comboselector.defaults,g.fn.comboselector.parseOptions(this),i)});e(this)}})};g.fn.comboselector.parseOptions=function(i){return g.extend({},g.fn.combo.parseOptions(i),g.fn.datagrid.parseOptions(i),g.parser.parseOptions(i,["text","selector","iconCls",{extToolbar:"boolean"}]))};g.fn.comboselector.methods={options:function(k){var j=k.combo("options"),i=g.data(k[0],"comboselector").options;return g.extend(i,{originalValue:j.originalValue,originalText:j.originalText,disabled:j.disabled,readonly:j.readonly})},setValues:function(j,i){return j.each(function(){c(this,i)})},setValue:function(j,i){return j.each(function(){c(this,[i])})},setText:function(j,i){return j.each(function(){b(this,i)})},loadData:function(j,i){return j.each(function(){a(this,i)})},getData:function(i){return g.data(i[0],"comboselector").data},reset:function(i){return i.each(function(){f(this)})}};g.fn.comboselector.defaults=g.extend({},g.fn.combo.defaults,{selector:"grid",text:null,extToolbar:false,panelWidth:"auto",panelHeight:"auto",autoShowPanel:false,iconCls:"icon-standard-application-form-magnify",lazyLoad:true,url:null,data:null,selectorTypes:d,onLoadSuccess:function(i){},onLoadError:function(){},onBeforeLoad:function(i){}});if(g.fn.datagrid){g.extend(g.fn.datagrid.defaults.editors,{comboselector:{init:function(i,j){var k=g('<input type="text"></input>').appendTo(i).comboselector(j);k.comboselector("textbox").addClass("datagrid-editable-input");return k},destroy:function(i){g(i).comboselector("destroy")},getValue:function(k){var i=g(k),j=i.comboselector("options");return i.comboselector(j.multiple?"getValues":"getValue")},setValue:function(l,k){var i=g(l),j=i.comboselector("options");if(k){if(j.multiple){if(g.util.likeArrayNotString(k)){i.comboselector("setValues",k)}else{if(typeof k=="string"){i.comboselector("setValues",k.split(j.separator))}else{i.comboselector("setValue",k)}}}else{i.comboselector("setValue",k)}}else{i.comboselector("clear")}},resize:function(j,i){g(j).comboselector("resize",i)},setFocus:function(i){g(i).comboselector("textbox").focus()}}})}g.parser.plugins.push("comboselector");if(g.fn.form&&g.isArray(g.fn.form.comboList)){g.fn.form.comboList.push("comboselector")}})(jQuery);