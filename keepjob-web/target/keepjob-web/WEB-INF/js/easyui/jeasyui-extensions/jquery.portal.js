(function(a){function d(k){a(k).addClass("portal");var h=a('<table border="0" cellspacing="0" cellpadding="0"><tr></tr></table>').appendTo(k);var j=h.find("tr");var f=[];var e=0;a(k).children("div:first").addClass("portal-column-left");a(k).children("div:last").addClass("portal-column-right");a(k).find(">div").each(function(){var i=a(this);e+=i.outerWidth();f.push(i.outerWidth());var l=a('<td class="portal-column-td"></td>').appendTo(j);i.addClass("portal-column").appendTo(l);i.find(">div").each(function(){var o=a(this).addClass("portal-p").panel({doSize:false,cls:"portal-panel"});var n=o.panel("options"),m=n.onClose;n.onClose=function(){if(a.isFunction(m)){m.apply(this,arguments)}a(this).panel("destroy")};b(k,o)})});for(var g=0;g<f.length;g++){f[g]/=e}a(k).bind("_resize",function(){var i=a.data(k,"portal").options;if(i.fit==true){c(k)}return false});return f}function c(l){var o=a(l);var e=a.data(l,"portal").options;if(e.fit){var g=o.parent();e.width=g.width();e.height=g.height()}if(!isNaN(e.width)){o._outerWidth(e.width)}else{o.width("auto")}if(!isNaN(e.height)){o._outerHeight(e.height)}else{o.height("auto")}var n=o.find(">table").outerHeight()>o.height();var h=o.width();var f=a.data(l,"portal").columnWidths;var j=0;for(var k=0;k<f.length;k++){var g=o.find("div.portal-column:eq("+k+")");var m=Math.floor(h*f[k]);if(k==f.length-1){m=h-j-(n==true?18:0)}g._outerWidth(m);j+=g.outerWidth();g.find("div.portal-p").panel("resize",{width:g.width()})}e.onResize.call(l,e.width,e.height)}function b(i,f){var h;f.panel("panel").draggable({handle:">div.panel-header>div.panel-title",proxy:function(k){var l=a('<div class="portal-proxy">proxy</div>').insertAfter(k);l.width(a(k).width());l.height(a(k).height());l.html(a(k).html());l.find("div.portal-p").removeClass("portal-p").hide();return l},onBeforeDrag:function(k){k.data.startTop=a(this).position().top+a(i).scrollTop()},onStartDrag:function(k){a(this).hide();h=a('<div class="portal-spacer"></div>').insertAfter(this);j(a(this).outerWidth(),a(this).outerHeight())},onDrag:function(l){var k=e(l,this);if(k){if(k.pos=="up"){h.insertBefore(k.target)}else{h.insertAfter(k.target)}j(a(k.target).outerWidth())}else{var m=g(l);if(m){if(m.find("div.portal-spacer").length==0){h.appendTo(m);c(i);j(m.width())}}}},onStopDrag:function(l){a(this).css("position","static");a(this).show();h.hide();a(this).insertAfter(h);h.remove();c(i);f.panel("move");var k=a.data(i,"portal").options;k.onStateChange.call(i)}});function e(m,l){var k=null;a(i).find("div.portal-p").each(function(){var n=a(this).panel("panel");if(n[0]!=l){var o=n.offset();if(m.pageX>o.left&&m.pageX<o.left+n.outerWidth()&&m.pageY>o.top&&m.pageY<o.top+n.outerHeight()){if(m.pageY>o.top+n.outerHeight()/2){k={target:n,pos:"down"}}else{k={target:n,pos:"up"}}}}});return k}function g(l){var k=null;a(i).find("div.portal-column").each(function(){var m=a(this);var n=m.offset();if(l.pageX>n.left&&l.pageX<n.left+m.outerWidth()){k=m}});return k}function j(l,k){h._outerWidth(l);if(k){h._outerHeight(k)}}}a.fn.portal=function(e,f){if(typeof e=="string"){return a.fn.portal.methods[e](this,f)}e=e||{};return this.each(function(){var g=a.data(this,"portal");if(g){a.extend(g.options,e)}else{g=a.data(this,"portal",{options:a.extend({},a.fn.portal.defaults,a.fn.portal.parseOptions(this),e),columnWidths:d(this)})}if(g.options.border){a(this).removeClass("portal-noborder")}else{a(this).addClass("portal-noborder")}c(this)})};a.fn.portal.methods={options:function(e){return a.data(e[0],"portal").options},resize:function(f,e){return f.each(function(){if(e){var g=a.data(this,"portal").options;if(e.width){g.width=e.width}if(e.height){g.height=e.height}}c(this)})},getPanels:function(h,f){var g=h;if(f>=0){g=h.find("div.portal-column:eq("+f+")")}var e=[];g.find("div.portal-p").each(function(){e.push(a(this))});return e},add:function(f,e){return f.each(function(){if(!e||!a.isNumeric(e.columnIndex)||!e.panel){return}var g=a(this),j=g.portal("options");if(j.onBeforeAdd.call(this,e.columnIndex,e.panel)==false){return}var l=g.find("div.portal-column:eq("+e.columnIndex+")");var k=e.panel.addClass("portal-p");k.panel("panel").addClass("portal-panel").appendTo(l);b(this,k);k.panel("resize",{width:l.width()});var i=k.panel("options"),h=i.onClose;i.onClose=function(){if(a.isFunction(h)){h.apply(this,arguments)}if(!k.length){return}var m=a("body");if(a.contains(m[0],k[0])){k.panel("destroy")}};j.onAdd.call(this,e.columnIndex,e.panel)})},remove:function(f,e){return f.each(function(){var l=a(this),k=l.portal("options");if(k.onBeforeRemove.call(this,e)==false){return}var h=l.portal("getPanels"),g=e.panel("options");for(var j=0;j<h.length;j++){var l=h[j];if(l[0]==a(e)[0]){l.panel("destroy")}}k.onRemove.call(this,g)})},addColumn:function(e){return e.each(function(){var g=a.data(this,"portal"),f=g.options,h=g.columnWidths,p=a(this),n=p.outerWidth(),o=p.find(">table tr"),k=a("<td></td>").addClass("portal-column-td").appendTo(o),l=a("<div></div>").addClass("portal-column").appendTo(k),j=parseFloat(1)/(h.length+1);if(f.onBeforeAddColumn.call(this,h.length)==false){return}for(var m=0;m<h.length;m++){h[m]=j}h.push(j);o.find(">td>div.portal-column").removeClass("portal-column-left portal-column-right");o.find(">td>div.portal-column:first").addClass("portal-column-left");o.find(">td>div.portal-column:last").addClass("portal-column-right");c(this);f.onAddColumn.call(this,h.length-1)})},removeColumn:function(f,e){return f.each(function(){var m=a.data(this,"portal"),k=m.options,g=m.columnWidths;if(!a.isNumeric(e)||!g||!g.length||e>g.length-1){return}if(k.onBeforeRemoveColumn.call(this,e)==false){return}var l=a(this).find(">table tr"),j=parseFloat(1)/(g.length-1);g.pop();for(var h=0;h<g.length;h++){g[h]=j}l.find(">td:eq("+e+")").remove();l.find(">td>div.portal-column").removeClass("portal-column-left portal-column-right");l.find(">td>div.portal-column:first").addClass("portal-column-left");l.find(">td>div.portal-column:last").addClass("portal-column-right");c(this);k.onRemoveColumn.call(this,e)})},columns:function(e){return a.data(e[0],"portal").columnWidths.length},disableDragging:function(f,e){e.panel("panel").draggable("disable");return f},enableDragging:function(f,e){e.panel("panel").draggable("enable");return f}};a.fn.portal.parseOptions=function(e){return a.extend({},a.parser.parseOptions(e,["width","height",{border:"boolean",fit:"boolean"}]))};a.fn.portal.defaults={width:"auto",height:"auto",border:true,fit:false,onResize:function(f,e){},onStateChange:function(){},onBeforeAdd:function(f,e){},onAdd:function(f,e){},onBeforeAddColumn:function(e){},onAddColumn:function(e){},onBeforeRemove:function(e){},onRemove:function(e){},onBeforeRemoveColumn:function(e){},onRemoveColumn:function(e){}};a.parser.plugins.push("portal")})(jQuery);