(function(a,b){a.util.namespace("$.easyui");a.easyui.showGridSelector=function(c){if(c&&c.topMost&&a!=a.util.$){return a.util.$.easyui.showGridSelector.apply(this,arguments)}var d=a.extend({width:580,height:360,minWidth:580,minHeight:360,title:"选择数据，"+(c.singleSelect?"单选":"多选"),iconCls:"icon-hamburg-zoom",maximizable:true,collapsible:true,selected:null,extToolbar:false,onEnter:function(i){}},c);var e=d.singleSelect?d.selected:(a.util.likeArrayNotString(d.selected)?d.selected:(d.selected?[d.selected]:[])),g=e?(a.util.likeArrayNotString(e)?a.array.clone(e):e):null,f=null,h=a.easyui.showDialog(a.extend({},d,{content:'<div class="grid-selector-container"></div>',saveButtonText:"确定",saveButtonIconCls:"icon-ok",enableApplyButton:false,toolbar:"",onSave:function(){if(a.isFunction(d.onEnter)){return d.onEnter.call(f[0],e)}}}));a.util.exec(function(){var j=h.find(".grid-selector-container"),k=a.util.excludeProperties(d,["id","width","height","left","top","cls","bodyCls","style","content","href"]),i=function(o){var n=f.datagrid("options"),m=n.idField;f.datagrid("selectRecord",m&&o&&o[m]?o[m]:o)},l=function(){var m=f.datagrid("options");if(d.singleSelect){var n=f.datagrid("getSelected");e=n?n:null}else{e=f.datagrid("getSelections")}};k=a.extend({striped:true,checkOnSelect:true,selectOnCheck:true,rownumbers:true},k,{noheader:true,fit:true,border:false,doSize:true,onSelect:function(m,n){l()},onUnselect:function(m,n){l()},onSelectAll:function(m){l()},onUnselectAll:function(m){l()},onLoadSuccess:function(m){a.fn.datagrid.defaults.onLoadSuccess.apply(this,arguments);if(a.isFunction(d.onLoadSuccess)&&d.onLoadSuccess!=a.fn.datagrid.defaults.onLoadSuccess){d.onLoadSuccess.apply(this,arguments)}if(!g){return}if(a.util.likeArrayNotString(g)){a.each(g,function(n,o){i(o)})}else{i(g)}l()}});if(a.util.likeArrayNotString(d.toolbar)&&d.extToolbar){k.toolbar=null;j.append('<div data-options="region: \'north\', split: false, border: false"><div class="grid-selector-toolbar"></div></div><div data-options="region: \'center\', border: false"><div class="grid-selector"></div></div>');j.find("div.grid-selector-toolbar").toolbar({data:d.toolbar});f=j.find("div.grid-selector");j.layout({fit:true})}else{f=j.addClass("grid-selector")}h.grid=f.datagrid(k)});return h};a.easyui.showDblGridSelector=function(c){if(c&&c.topMost&&a!=a.util.$){return a.util.$.easyui.showDblGridSelector.apply(this,arguments)}var d=a.extend({width:900,height:580,minWidth:600,minHeight:480,title:"选择数据，多选",iconCls:"icon-hamburg-zoom",maximizable:true,collapsible:true,selected:null,centerWidth:55,extToolbar:false,onEnter:function(i){}},c);var e=a.util.likeArrayNotString(d.selected)?d.selected:(d.selected?[d.selected]:[]),g=a.array.clone(e),f=null,h=a.easyui.showDialog(a.extend({},d,{content:'<div class="grid-selector-container"></div>',saveButtonText:"确定",saveButtonIconCls:"icon-ok",enableApplyButton:false,toolbar:d.extToolbar?"":d.toolbar,onSave:function(){if(a.isFunction(d.onEnter)){return d.onEnter.call(f[0],e)}}}));a.util.exec(function(){var v=h.dialog("options"),n=v.onResize,z=false,u=h.find(".grid-selector-container"),o=null,x=((a.isNumeric(d.width)?d.width:h.outerWidth())-d.centerWidth)/2,A=a("<div data-options=\"region: 'west', split: false, border: false\"></div>").width(x).appendTo(u),t=a("<div data-options=\"region: 'center', border: true, bodyCls: 'grid-selector-buttons'\"></div>").appendTo(u),B=a("<div data-options=\"region: 'east', split: false, border: false\"></div>").width(x).appendTo(u),w=a.util.excludeProperties(d,["id","width","height","left","top","cls","bodyCls","style","content","href"]),s=a.extend({striped:true,checkOnSelect:true,selectOnCheck:true,rownumbers:true},w,{singleSelect:false,title:"待选择项",toolbar:"",fit:true,border:false,doSize:true,noheader:false,iconCls:null,collapsible:false,minimizable:false,maximizable:false,closable:false,rowContextMenu:[{text:"选择该行",iconCls:null,handler:function(E,D,F){i(F);y()}},"-",{text:"选择全部",iconCls:null,handler:function(E,D,F){m.trigger("click")}},{text:"选择勾选部分",iconCls:null,handler:function(E,D,F){l.trigger("click")}}],onLoadSuccess:function(){a.fn.datagrid.defaults.onLoadSuccess.apply(this,arguments);if(a.isFunction(d.onLoadSuccess)&&d.onLoadSuccess!=a.fn.datagrid.defaults.onLoadSuccess){d.onLoadSuccess.apply(this,arguments)}if(!z){a.each(g,function(D,E){i(E)});y();z=true}}}),r=a.extend({},s,{url:null,queryParams:{},remoteSort:false,pagination:false,title:"已选择项",iconCls:null,pagingMenu:false,refreshMenu:false,rowContextMenu:[{text:"取消该行",iconCls:null,handler:function(E,D,F){C(F);y()}},"-",{text:"取消全部",iconCls:null,handler:function(E,D,F){j.trigger("click")}},{text:"取消勾选部分",iconCls:null,handler:function(E,D,F){k.trigger("click")}}],onLoadSuccess:a.fn.datagrid.defaults.onLoadSuccess}),q=a("<div></div>").appendTo(A),p=f=a('<div class="grid-selector"></div>').appendTo(B),m=a("<a></a>").linkbutton({plain:true,iconCls:"pagination-last"}).tooltip({content:"选择全部"}).appendTo(t).click(function(){var E=q.datagrid("getRows"),D=a.array.clone(E);a.each(D,function(F,G){i(G)});q.datagrid("unselectAll");y()}),l=a("<a></a>").linkbutton({plain:true,iconCls:"pagination-next"}).tooltip({content:"选择勾选部分"}).appendTo(t).click(function(){var E=q.datagrid("getSelections"),D=a.array.clone(E);if(!D.length){return a.easyui.messager.show("您未选择任何数据。")}a.each(D,function(F,G){i(G)});q.datagrid("unselectAll");y()}),k=a("<a></a>").linkbutton({plain:true,iconCls:"pagination-prev"}).tooltip({content:"取消勾选部分"}).appendTo(t).click(function(){var E=p.datagrid("getSelections"),D=a.array.clone(E);if(!D.length){return a.easyui.messager.show("您未选择任何数据。")}a.each(D,function(F,G){C(G)});p.datagrid("unselectAll");y()}),j=a("<a></a>").linkbutton({plain:true,iconCls:"pagination-first"}).tooltip({content:"取消全部"}).appendTo(t).click(function(){var E=p.datagrid("getRows"),D=a.array.clone(E);a.each(D,function(F,G){C(G)});p.datagrid("unselectAll");y()}),i=function(I){if(!I){return}var G=p.datagrid("options"),F=G.idField;if(!I[F]){var H=q.datagrid("getRows"),E=q.datagrid("getRowIndex",I);if(E>-1){I=H[E]}}var D=p.datagrid("getRowIndex",I[F]?I[F]:I)>-1;if(!D){p.datagrid("appendRow",I)}},C=function(E){if(!E){return}var D=p.datagrid("getRowIndex",E);if(D>-1){p.datagrid("deleteRow",D)}},y=function(){var D=p.datagrid("getRows");e=a.array.clone(D)};v.onResize=function(D,E){if(a.isFunction(n)){n.apply(this,arguments)}a.util.exec(function(){var F=(h.panel("options").width-v.centerWidth)/2;A.panel("resize",{width:F});B.panel("resize",{width:F});u.layout("resize")})};if(d.extToolbar&&d.toolbar){o=a("<div data-options=\"region: 'north', split: false, border: false\"></div>").appendTo(u);a('<div class="grid-selector-toolbar"></div>').appendTo(o).toolbar({data:d.toolbar})}h.grid=q.datagrid(s);h.valueGrid=p.datagrid(r);u.layout({fit:true})});return h};a.easyui.showTreeSelector=function(c){if(c&&c.topMost&&a!=a.util.$){return a.util.$.easyui.showTreeSelector.apply(this,arguments)}};a.easyui.showTreeGridSelector=function(c){if(c&&c.topMost&&a!=a.util.$){return a.util.$.easyui.showTreeGridSelector.apply(this,arguments)}};a.easyui.showTreeWithGridSelector=function(c){if(c&&c.topMost&&a!=a.util.$){return a.util.$.easyui.showDblTreeGridSelector.apply(this,arguments)}}})(jQuery);