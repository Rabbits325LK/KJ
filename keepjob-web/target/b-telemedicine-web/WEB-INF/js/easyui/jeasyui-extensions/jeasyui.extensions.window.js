(function(d,g){d.fn.window.extensions={};var a=function(u){var x=d(u),k=d.data(u,"window"),j=x.window("options"),s=x.window("window"),r=x.window("body");if(!j._initialized){x.window("header").on({dblclick:function(){var t=x.window("options");if(t.autoRestore){if(t.maximized){x.window("restore")}else{if(t.maximizable){x.window("maximize")}}}},contextmenu:function(A){var z=x.window("options");if(z.enableHeaderContextMenu){A.preventDefault();var y=[{text:"最大化",iconCls:"panel-tool-max",disabled:!z.maximized&&z.maximizable?false:true,onclick:function(){x.window("maximize")}},{text:"恢复",iconCls:"panel-tool-restore",disabled:z.maximized?false:true,onclick:function(){x.window("restore")}},"-",{text:"关闭",iconCls:"panel-tool-close",disabled:!z.closable,onclick:function(){x.window("close")}}];var t=d.array.likeArray(z.headerContextMenu)?z.headerContextMenu:[];if(t.length){d.array.insertRange(y,0,d.util.merge([],t,"-"))}y=f(A,y,x);d.easyui.showMenu({items:y,left:A.pageX,top:A.pageY})}}});if(j.bodyCls){r.addClass(j.bodyCls)}if(j.draggable){var i=k.window.draggable("options"),w=i.cursor,n=i.onBeforeDrag,p=i.onStartDrag,q=i.onStopDrag,o=i.onDrag;i.cursor="default";i.onBeforeDrag=function(y){var t=n.apply(this,arguments);if(t==false||y.which!=1||x.window("options").maximized){return false}i.cursor=w};i.onStartDrag=function(){p.apply(this,arguments);x.window("body").addClass("window-body-hidden").children().addClass("window-body-hidden-proxy")};i.onStopDrag=function(){q.apply(this,arguments);x.window("body").removeClass("window-body-hidden").children().removeClass("window-body-hidden-proxy");i.cursor="default"};i.onDrag=function(E){if(!j.inContainer){return o.apply(this,arguments)}var D=E.data.left,C=E.data.top,B=s.parent(),y=B.is("body"),A=d.extend({},y?d.util.windowSize():{width:B.innerWidth(),height:B.innerHeight()}),z=d.isNumeric(j.width)?j.width:s.outerWidth(),t=d.isNumeric(j.height)?j.height:s.outerHeight();if(D<0){D=0}if(C<0){C=0}if(D+z>A.width&&D>0){D=A.width-z;b=true}if(C+t>A.height&&C>0){C=A.height-t;b=true}k.proxy.css({display:"block",left:D,top:C});return false}}if(j.resizable){var m=k.window.resizable("options"),l=m.onResize,v=m.onStopResize;m.onResize=function(D){if(!j.minWidth&&!j.maxWidth&&!j.minHeight&&!j.maxHeight){return l.apply(this,arguments)}k.proxy.css({left:D.data.left,top:D.data.top});var z=D.data.width,t=D.data.height,y=d.isNumeric(j.minWidth)?j.minWidth:e.minHeight,B=d.isNumeric(j.maxWidth)?j.maxWidth:e.maxWidth,C=d.isNumeric(j.minHeight)?j.minHeight:e.minHeight,A=d.isNumeric(j.maxHeight)?j.maxHeight:e.maxHeight;if(z>j.maxWidth){z=B;resizable=true}if(z<j.minWidth){z=y;resizable=true}if(t>j.maxHeight){t=A;resizable=true}if(t<j.minHeight){t=C;resizable=true}k.proxy._outerWidth(z);k.proxy._outerHeight(t);return false};m.onStopResize=function(y){var t=v.apply(this,arguments);if(x.window("options").maximized){x.window("restore").window("maximize")}return t}}j._initialized=true}};function f(k,i,j){return d.array.map(i,function(n,m){if(!n||d.util.isString(n)){return n}var l=d.extend({},n);l.id=d.isFunction(n.id)?n.id.call(l,k,j):n.id;l.text=d.isFunction(n.text)?n.text.call(l,k,j):n.text;l.iconCls=d.isFunction(n.iconCls)?n.iconCls.call(l,k,j):n.iconCls;l.disabled=d.isFunction(n.disabled)?n.disabled.call(l,k,j):n.disabled;l.hideOnClick=d.isFunction(n.hideOnClick)?n.hideOnClick.call(l,k,j):n.hideOnClick;l.onclick=d.isFunction(n.onclick)?function(p,o,q){n.onclick.call(this,p,j,o,q)}:n.onclick;l.handler=d.isFunction(n.handler)?function(p,o,q){n.handler.call(this,p,j,o,q)}:n.handler;if(l.children&&l.children.length){l.children=f(k,l.children,j)}return l})}var h=d.fn.window;d.fn.window=function(i,j){if(typeof i=="string"){return h.apply(this,arguments)}i=i||{};return this.each(function(){var m=d(this),k=d.data(this,"window")?true:false,l=k?i:d.extend({},d.fn.window.parseOptions(this),d.parser.parseOptions(this,[{autoHCenter:"boolean",autoVCenter:"boolean",autoCloseOnEsc:"boolean",autoRestore:"boolean",enableHeaderContextMenu:"boolean"}]),i);h.call(m,l);a(this)})};d.union(d.fn.window,h);var c=d.fn.window.extensions.methods={};var e=d.fn.window.extensions.defaults=d.extend({},d.fn.panel.extensions.defaults,{autoHCenter:false,autoVCenter:false,autoCloseOnEsc:true,autoRestore:true,enableHeaderContextMenu:true,headerContextMenu:null});d.extend(d.fn.window.defaults,e);d.extend(d.fn.window.methods,c);d(function(){d(window).resize(function(){d(".panel-body.window-body").each(function(){var j=d(this),i=j.window("options");if(i&&i.draggable){if(i.autoHCenter||i.autoVCenter){var k=i.autoHCenter&&i.autoVCenter?"center":(i.autoHCenter?"hcenter":"vcenter");j.window(k)}else{if(i.inContainer){j.window("move")}}}})});d(document).keydown(function(i){if(i.which==27){d("div.window-mask:last").prevAll("div.panel.window:first").children(".panel-body.window-body").each(function(){var k=d(this),j=k.window("options");if(j&&j.closable&&j.autoCloseOnEsc&&!k.window("header").find(".panel-tool a").attr("disabled")){d.util.exec(function(){k.window("close")})}})}});d("body").on("click","div.window-mask:last",function(i){d(this).prevAll("div.panel.window:first").shine()})})})(jQuery);