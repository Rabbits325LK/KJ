(function(F,i){F.fn.tabs.extensions={};function b(V){var T=F(V),U=F.data(V,"tabs").options,S=U.tabPosition;if(F.isNumeric(U.lineHeight)&&U.lineHeight>0){if(!F.array.contains(["top","bottom","left","right"],S)){S="top"}T.children("div.tabs-panels").css("padding-"+S,U.lineHeight.toString()+"px").children().children().css("border-"+S+"-width","1px")}}var L=F.fn.tabs.defaults.onContextMenu;var A=function(ai,ap,X){if(F.isFunction(L)){L.apply(this,arguments)}var ab=F(this),ac=ab.tabs("options");if(ac.enableConextMenu){ai.preventDefault();var aa=ab.tabs("getTab",X),Y=aa.panel("options"),V=ab.tabs("leftClosableTabs",X),Z=ab.tabs("rightClosableTabs",X),ah=ab.tabs("otherClosableTabs",X),af=ab.tabs("closableTabs"),ae=ab.tabs("isSelected",X),W={text:"在新页面中打开",iconCls:"icon-standard-shape-move-forwards",disabled:Y.href&&Y.iniframe?false:true,handler:function(){ab.tabs("jumpTab",X)}},U={text:"显示 Option",iconCls:"icon-standard-application-form",disabled:ac.showOption?false:true,children:[{text:"选项卡组 Option",iconCls:"icon-standard-tab-go",handler:function(){ab.tabs("showOption")}},{text:"该选项卡 Option",iconCls:"icon-standard-tab",handler:function(){ab.tabs("showOption",X)}}]},T={text:"关闭选项卡",iconCls:"icon-standard-application-form-delete",disabled:Y.closable?false:true,handler:function(){ab.tabs("closeClosable",X)}},S={text:"关闭其他选项卡",iconCls:"icon-standard-cancel",disabled:ah.length?false:true,handler:function(){ab.tabs("closeOtherClosable",X)}},ao={text:"刷新选项卡",iconCls:"icon-standard-table-refresh",disabled:Y.refreshable&&Y.href?false:true,handler:function(){ab.tabs("refresh",X)}},an={text:"关闭左侧选项卡",iconCls:"icon-standard-tab-close-left",disabled:V.length?false:true,handler:function(){ab.tabs("closeLeftClosable",X)}},am={text:"关闭右侧选项卡",iconCls:"icon-standard-tab-close-right",disabled:Z.length?false:true,handler:function(){ab.tabs("closeRightClosable",X)}},al={text:"关闭所有选项卡",iconCls:"icon-standard-cross",disabled:af.length?false:true,handler:function(){ab.tabs("closeAllClosable")}},ak={text:"新建选项卡",iconCls:"icon-standard-tab-add",disabled:ac.enableNewTabMenu?false:true,handler:function(){ab.tabs("newTab",X)}},aj={text:"重复选项卡",iconCls:"icon-standard-control-repeat",disabled:Y.repeatable?false:true,handler:function(){ab.tabs("repeat",X)}};var ad=[];if(F.array.likeArray(ac.contextMenu)&&!F.util.isString(ac.contextMenu)){F.array.merge(ad,ac.contextMenu)}if(ac.enableJumpTabMenu){F.array.merge(ad,"-",W)}if(ac.showOption){F.array.merge(ad,"-",U)}F.array.merge(ad,Y.closable?["-",T,S]:["-",S]);if(Y.refreshable){F.array.merge(ad,"-",ao)}F.array.merge(ad,"-",an,am,al);if(Y.repeatable||ac.enableNewTabMenu){var ag=[];if(ac.enableNewTabMenu){ag.push(ak)}if(Y.repeatable){ag.push(aj)}F.array.merge(ad,"-",ag)}ad=z(ai,ap,X,ad,ab);if(ad[0]=="-"){F.array.removeAt(ad,0)}F.easyui.showMenu({left:ai.pageX,top:ai.pageY,items:ad})}};function z(V,W,S,U,T){return F.array.map(U,function(Y){if(!Y||F.util.isString(Y)){return Y}var X=F.extend({},Y);X.id=F.isFunction(Y.id)?Y.id.call(X,V,W,S,T):Y.id;X.text=F.isFunction(Y.text)?Y.text.call(X,V,W,S,T):Y.text;X.iconCls=F.isFunction(Y.iconCls)?Y.iconCls.call(X,V,W,S,T):Y.iconCls;X.disabled=F.isFunction(Y.disabled)?Y.disabled.call(X,V,W,S,T):Y.disabled;X.hideOnClick=F.isFunction(Y.hideOnClick)?Y.hideOnClick.call(X,V,W,S,T):Y.hideOnClick;X.onclick=F.isFunction(Y.onclick)?function(aa,Z,ab){Y.onclick.call(this,aa,W,S,T,Z,ab)}:Y.onclick;X.handler=F.isFunction(Y.handler)?function(aa,Z,ab){Y.handler.call(this,aa,W,S,T,Z,ab)}:Y.handler;if(X.children&&X.children.length){X.children=z(V,W,S,X.children,T)}return X})}var R=F.fn.tabs.methods.update;function h(ac,V){V=F.extend({tab:null,options:null},V);var ae=F(ac),S=F.data(ac,"tabs").options,aa=ae.tabs("getTabIndex",V.tab),af=F.union({},V.options,F.fn.tabs.extensions.panelOptions),Z=af.tools,ad=af.onLoad,Y=af.onError,T=F.array.contains(["mask","progress","none"],S.updateProgress)?S.updateProgress:"mask",W=function(){if(T=="mask"){F.easyui.loading({topMost:true,msg:af.loadingMessage})}else{if(T=="progress"){F.easyui.messager.progress({title:"操作提醒",msg:af.loadingMessage,interval:100})}}},X=function(){if(T=="mask"){F.easyui.loaded({topMost:true})}else{if(T=="progress"){F.easyui.messager.progress("close")}}},ag={iconCls:"icon-mini-refresh",handler:function(){var ah=F(this).parent().prev().find("span.tabs-title").text();if(ah){F.util.exec(function(){ae.tabs("refresh",ah)})}}};if(af.refreshable){if(F.util.likeArrayNotString(af.tools)){af.tools=F.array.merge([],af.tools,ag)}else{af.tools=[ag]}}if(T!="none"&&!F.string.isNullOrWhiteSpace(af.href)&&(af.selected||ae.tabs("getSelected")==V.tab)){W();af.onLoad=function(){if(F.isFunction(ad)){ad.apply(this,arguments)}F.util.exec(X);F(this).panel("options").onLoad=ad};af.onError=function(){if(F.isFunction(Y)){Y.apply(this,arguments)}F.util.exec(X);F(this).panel("options").onError=Y}}var ab=R.call(ae,ae,{tab:V.tab,options:af});var U=ae.tabs("getTab",aa);af=U.panel("options");af.tools=Z;b(ac);if(af.closeOnDblClick&&af.closable){ae.find(">div.tabs-header>div.tabs-wrap>ul.tabs>li").eq(aa).off("dblclick.closeOnDblClick").on("dblclick.closeOnDblClick",function(){ae.tabs("close",af.title)}).attr("title","双击此选项卡标题可以将其关闭")}return ab}function P(X,Y){var V=F(X),W=V.tabs("options"),S=V.tabs("getTab",Y),T=S.panel("options"),U=V.tabs("getTabIndex",S);if(F.string.isNullOrWhiteSpace(T.href)&&F.string.isNullOrWhiteSpace(T.content)){return}V.tabs("update",{tab:S,options:T});if(F.isFunction(W.onRefresh)){W.onRefresh.call(X,W.title,U)}}function O(X,Y){var T=F(X),U=T.tabs("getSelected"),S=T.tabs("getTabIndex",U);var V=T.tabs("getTab",Y),W=T.tabs("getTabIndex",V);return W==S}function j(V,W){var U=F(V),S=U.tabs("getTab",W),T=S.panel("options");return T.closable}function C(ah,V){var Y=F("<table></table>").css({width:"95%",height:"100%"}),W=F("<input type='text' style='width: 98%;'/>"),ad=F("<input type='text' style='width: 98%;'/>"),aa=F("<input id='refreshable' type='checkbox' checked='true' />"),X=F("<input id='iniframe' type='checkbox' />"),ak=F("<label>是否可刷新</label>"),S=F("<label>是否嵌至 IFRAME(浏览器内部窗体) 中</label>");var ag=F("<tr></tr>").append("<td width='24%' align='right'>选项卡标题：</td>").appendTo(Y);var af=F("<tr></tr>").append("<td width='24%' align='right'>路径(href)：</td>").appendTo(Y);var ae=F("<tr></tr>").appendTo(Y);F("<td></td>").append(W).appendTo(ag);F("<td></td>").append(ad).appendTo(af);F("<td width='24%' align='right'></td>").append(aa).append(ak).appendTo(ae);F("<td align='right'></td>").append(X).append(S).appendTo(ae);V=V||0;var ac=F(ah),U=F.isNumeric(V)?V:ac.tabs("getTabIndex",ac.tabs("getTab",V)),Z=ac.find(">div.tabs-header>div.tabs-wrap>ul.tabs>li:eq("+U+")"),T=Z.offset(),ai=F.extend({},{left:T.left+10,top:T.top+10});var ab=F.extend({iconCls:"icon-standard-application-form",title:"新建选项卡 - 设置参数",width:400,height:165,maximizable:false,resizable:false,autoVCenter:false,autoHCenter:false,enableSaveButton:false,topMost:false,applyButtonIndex:1,applyButtonText:"打开",onApply:function(aq){var ap=W.val(),am=ad.val();am=am||F.fn.tabs.extensions.panelOptions.href;if(F.string.isNullOrWhiteSpace(ap)){ap="新建选项卡"}var an=0;while(ac.tabs("getTab",ap=ap+(an?an:""))){an++}if(F.string.isNullOrWhiteSpace(am)){F.easyui.messager.show("操作提醒","请输入要创建的选项卡的路径！","info");ad.focus();return}var al=X.prop("checked"),ao=aa.prop("checked");ac.tabs("add",{title:ap,href:am,refreshable:ao,closable:true,iniframe:al});aq.dialog("close")},content:Y},ai);var aj=F.easyui.showDialog(ab);F.util.exec(function(){var al=aj.find(">div.dialog-button>a:first");W.keydown(function(am){if(am.which==13){ad.focus()}});ad.keydown(function(am){if(am.which==13){aa.focus()}});aa.keydown(function(am){if(am.which==13){X.focus()}});X.keydown(function(am){if(am.which==13){al.focus()}});ak.click(function(){aa.click()});S.click(function(){X.click()});al.focus();W.focus()})}function x(X,Z){var V=F(X),S=V.tabs("getTab",Z),T=S.panel("options");var W=F.extend({},T,{selected:true,closable:true}),U=2,Y=W.title;while(V.tabs("getTab",W.title=Y+"-"+U.toString())){U++}V.tabs("add",W)}function w(U,V){var S=F(U),T=S.tabs("getTab",V),W=T.panel("options");return W}function e(U){var S=F(U),T=S.tabs("getSelected"),V=T.panel("options");return V}function E(V){var T=F(V),U=T.tabs("getSelected"),S=T.tabs("getTabIndex",U);return S}function D(T){var S=F(T),V=S.tabs("getSelectedOption"),U=V.title;return U}function J(V,W){var U=F(V),T=F.isNumeric(W)?W:U.tabs("getTabIndex",U.tabs("getTab",W)),S=U.tabs("tabs");return F.array.range(S,0,T)}function a(V,W){var U=F(V),T=F.isNumeric(W)?W:U.tabs("getTabIndex",U.tabs("getTab",W)),S=U.tabs("tabs");return F.array.range(S,T+1)}function G(V,W){var U=F(V),T=F.isNumeric(W)?W:U.tabs("getTabIndex",U.tabs("getTab",W)),S=U.tabs("tabs");return F.array.merge(F.array.range(S,0,T),F.array.range(S,T+1))}function n(T){if(F.util.isJqueryObject(T)&&T.length){var S=F.data(T[0],"panel");return S&&S.options&&S.options.closable}else{return false}}function y(U){var T=F(U),S=T.tabs("tabs");return F.array.filter(S,n)}function B(U,V){var T=F(U),S=T.tabs("leftTabs",V);return F.array.filter(S,n)}function g(U,V){var T=F(U),S=T.tabs("rightTabs",V);return F.array.filter(S,n)}function u(U,V){var T=F(U),S=T.tabs("otherTabs",V);return F.array.filter(S,n)}function d(U,V){var T=F(U),S=T.tabs("leftTabs",V);F.each(S,function(){T.tabs("close",T.tabs("getTabIndex",this))})}function l(U,V){var T=F(U),S=T.tabs("rightTabs",V);F.each(S,function(){T.tabs("close",T.tabs("getTabIndex",this))})}function Q(U,V){var T=F(U),S=T.tabs("otherTabs",V);F.each(S,function(){T.tabs("close",T.tabs("getTabIndex",this))})}function N(U){var T=F(U),S=T.tabs("tabs");F.each(F.array.clone(S),function(){T.tabs("close",T.tabs("getTabIndex",this))})}function t(V,W){var U=F(V),S=U.tabs("getTab",W);if(S&&S.panel("options").closable){var T=F.isNumeric(W)?W:U.tabs("getTabIndex",S);U.tabs("close",T)}}function o(U,V){var T=F(U),S=T.tabs("leftClosableTabs",V);F.each(F.array.clone(S),function(){T.tabs("close",T.tabs("getTabIndex",this))})}function c(U,V){var T=F(U),S=T.tabs("rightClosableTabs",V);F.each(F.array.clone(S),function(){T.tabs("close",T.tabs("getTabIndex",this))})}function m(U,V){var T=F(U),S=T.tabs("otherClosableTabs",V);F.each(F.array.clone(S),function(){T.tabs("close",T.tabs("getTabIndex",this))})}function f(U,V){var T=F(U),S=T.tabs("closableTabs",V);F.each(F.array.clone(S),function(){T.tabs("close",T.tabs("getTabIndex",this))})}function p(V,W){var S=F(V),T,X;if(W!=null&&W!=i){var U=S.tabs("getTab",W);T=U.panel("options");X=U.panel("header").offset()}else{T=S.tabs("options");X=S.offset()}F.extend(X,{left:X.left+25,top:X.top+15});F.easyui.showOption(T,X)}function k(aa,W){if(!W||W.source==i||W.target==i||!W.point){return}var T=W.source,Y=W.target,ad=F.array.contains(["before","after"],W.point)?W.point:"before",ae=F(aa),ab=ae.tabs("tabs"),S=ae.tabs("getTab",T),Z=ae.tabs("getTab",Y),X=ae.tabs("getTabIndex",S),ac=S.panel("header"),U=Z.panel("header");if(!S||!Z){return}F.array.removeAt(ab,X);var V=F.array.indexOf(ab,Z);F.array.insert(ab,ad=="before"?V:V+1,S);S=S.panel("panel");Z=Z.panel("panel");Z[ad](S);U[ad](ac)}function K(S,T){var W=T.target,V=F(S);T.target=i;V.tabs("add",T);var U=V.tabs("tabs");V.tabs("move",{source:U.length-1,target:W,point:"before"})}function v(U,V){if(!V||!(V.which||F.isNumeric(V.which))||!V.title){return}var S=F(U),T=S.tabs("getTab",V.which);T.panel("setTitle",V.title)}function r(V,W){var S=F(V),T=(W==null||W==i)?S.tabs("getSelected"):S.tabs("getTab",W),U=T.panel("options");if(U.href&&U.iniframe){window.open(U.href,"_blank")}else{F.easyui.messager.show('"'+U.title+'" 选项卡不可在新页面中打开。')}}var s=F.fn.tabs.extensions.panelOptions=F.extend({},F.fn.panel.defaults,{iniframe:false,repeatable:false,refreshable:true,closeOnDblClick:true,href:null,iconCls:"icon-standard-application-form"});var I=F.fn.tabs.extensions.methods={update:function(T,S){return T.each(function(){h(this,S)})},refresh:function(T,S){return T.each(function(){P(this,S)})},isSelected:function(T,S){return O(T[0],S)},isClosable:function(T,S){return j(T[0],S)},newTab:function(T,S){return T.each(function(){C(this,S)})},repeat:function(T,S){return T.each(function(){x(this,S)})},getTabOption:function(T,S){return w(T[0],S)},getSelectedOption:function(S){return e(S[0])},getSelectedIndex:function(S){return E(S[0])},getSelectedTitle:function(S){return D(S[0])},leftTabs:function(T,S){return J(T[0],S)},rightTabs:function(T,S){return a(T[0],S)},otherTabs:function(T,S){return G(T[0],S)},closableTabs:function(S){return y(S[0])},leftClosableTabs:function(T,S){return B(T[0],S)},rightClosableTabs:function(T,S){return g(T[0],S)},otherClosableTabs:function(T,S){return u(T[0],S)},closeLeft:function(T,S){return T.each(function(){d(this,S)})},closeRight:function(T,S){return T.each(function(){l(this,S)})},closeOther:function(T,S){return T.each(function(){Q(this,S)})},closeAll:function(S){return S.each(function(){N(this)})},closeClosable:function(T,S){return T.each(function(){t(this,S)})},closeLeftClosable:function(T,S){return T.each(function(){o(this,S)})},closeRightClosable:function(T,S){return T.each(function(){c(this,S)})},closeOtherClosable:function(T,S){return T.each(function(){m(this,S)})},closeAllClosable:function(S){return S.each(function(){f(this)})},showOption:function(T,S){return T.each(function(){p(this,S)})},move:function(T,S){return T.each(function(){k(this,S)})},insert:function(T,S){return T.each(function(){K(this,S)})},setTitle:function(T,S){return T.each(function(){v(this,S)})},jumpTab:function(T,S){return T.each(function(){r(this,S)})}};var H=F.fn.tabs.extensions.defaults={lineHeight:2,enableConextMenu:true,enableNewTabMenu:false,enableJumpTabMenu:false,onRefresh:function(T,S){},contextMenu:null,onContextMenu:A,showOption:false,updateProgress:"mask"};F.extend(F.fn.tabs.defaults,H);F.extend(F.fn.tabs.methods,I);function q(W,T){T=T&&!F.util.isUtilTop?true:false;var V=F(W),S=V.currentTabs(),U;if(!T&&S.length){U=V.currentTabIndex();if(U>-1){S.tabs("close",U)}}else{var X=F.util.parent.$;V=X(F.util.currentFrame);S=V.currentTabs();if(S.length){U=V.currentTabIndex();if(U>-1){S.tabs("close",U)}}}}function M(W,T){T=T&&!F.util.isUtilTop?true:false;var V=F(W),S=V.currentTabs(),U;if(!T&&S.length){U=V.currentTabIndex();if(U>-1){S.tabs("refresh",U)}}else{var X=F.util.parent.$;V=X(F.util.currentFrame);S=V.currentTabs();if(S.length){U=V.currentTabIndex();if(U>-1){S.tabs("refresh",U)}}}}F.fn.extend({closeCurrentTab:function(S){return this.each(function(){q(this,S)})},refreshCurrentTab:function(S){return this.each(function(){M(this,S)})}})})(jQuery);