(function(f,h){f.fn.tree.extensions={};function x(I,J){var H=f(I);J=f(J)[0];return f.array.contains(H.tree("getRoots"),J,function(L,K){return L.target==K})}function g(J,K){var H=f(J),I,L;if(K){K=f(K)[0];I=H.tree("getNode",K);L=f(K).offset()}else{I=H.tree("options");L=H.offset()}f.extend(L,{left:L.left+25,top:L.top+15});f.easyui.showOption(I,L)}function p(J,K){var H=f(J),I=f(K);if(!H[0]||!I[0]||!I.is(".tree-node[node-id]")||!f.contains(H[0],I[0])){return 0}return I.parentsUntil("ul.tree","ul").length+1}function t(K,L){if(!L||!L.source||!L.target||!L.point){return}if(!f.array.contains(["append","top","bottom"],L.point)){L.point="append"}L.source=f(L.source)[0];L.target=f(L.target)[0];if(L.source==L.target){return}var H=f(K),J=H.tree("options");if(f.isFunction(J.onBeforeDrop)&&J.onBeforeDrop.call(K,L.target,L.source,L.point)==false){return}if(H.tree("isParent",{target1:L.source,target2:L.target})){return}var I=H.tree("pop",L.source);switch(L.point){case"append":H.tree("append",{parent:L.target,data:[I]});break;case"top":H.tree("insert",{before:L.target,data:I});break;case"bottom":H.tree("insert",{after:L.target,data:I});break;default:H.tree("append",{parent:L.target,data:[I]});break}if(I&&f.isFunction(J.onDrop)){J.onDrop.call(K,L.target,L.source,L.point)}}function l(J,L){if(!L||!L.target||!L.point||!f.array.contains(["up","upLevel","down","downLevel"],L.point)){return}L.target=f(L.target)[0];var H=f(J),I=L.target,K;switch(L.point){case"up":K=H.tree("prev",I);break;case"upLevel":K=H.tree("getParent",I);break;case"down":K=H.tree("next",I);break;case"downLevel":K=H.tree("prev",I);break;default:break}if(!K){return}H.tree("move",{source:I,target:K.target,point:L.point=="up"?"top":(L.point=="downLevel"?"append":"bottom")})}function C(H,I){if(m(H,I)){return"child"}if(E(H,I)){return"parent"}if(B(H,I)){return"sibling"}return"normal"}function m(L,M){var K=f(L),I=f(M.target1)[0],H=f(M.target2)[0];var J=K.tree("getChildren",H);return f.array.some(J,function(N){return N.target==I})}function E(L,M){var K=f(L),I=f(M.target1)[0],H=f(M.target2)[0];var J=K.tree("getChildren",I);return f.array.some(J,function(N){return N.target==H})}function B(L,N){var J=f(L),I=f(N.target1)[0],H=f(N.target2)[0],M=J.tree("getParent",I),K=J.tree("getParent",H);return M.target==K.target}function c(J,K){var I=f(K);if(!I.hasClass("tree-node")){return null}var K=I[0],H=I.closest("li").next().children("div.tree-node");if(!H.length){return null}return H.length?f(J).tree("getNode",H[0]):null}function v(J,K){var I=f(K);if(!I.hasClass("tree-node")){return null}var K=I[0],H=I.closest("li").prev().children("div.tree-node");if(!H.length){return null}return H.length?f(J).tree("getNode",H[0]):null}function k(I,J){var H=f(I);J=f(J);if(!f.contains(H[0],J[0])||!J.is("div.tree-node")){return null}return J.closest("ul").find("li>div.tree-node").map(function(){return H.tree("getNode",this)})}function u(I,J){var H=f(I);J=f(J);if(!f.contains(H[0],J[0])||!J.is("div.tree-node")){return null}return J.siblings("ul").find("li>div.tree-node").map(function(){return H.tree("getNode",this)})}function q(H,I){f(I).removeClass("tree-node-selected")}function d(K,L){var H=f(K);if(!L){return H.tree("reload")}if(typeof L=="string"){H.tree("options").url=L;return d(K,{})}var J=H.tree("options"),I=J.queryParams;J.queryParams=f.extend({},I,L);H.tree("reload")}function a(H,I){if(!I||!I.target||!I.iconCls){return}f(H).tree("update",{target:I.target,iconCls:I.iconCls})}function z(H,I){if(!I||!I.target||!I.text){return}f(H).tree("update",{target:I.target,text:I.text})}function e(I,J,H){H.onClickBak=J.onClick;J.onClick=function(K){if(f.isFunction(H.onClickBak)){H.onClickBak.apply(this,arguments)}if(J.toggleOnClick){I.tree("toggle",K.target)}}}function F(I,J,H){H.onContextMenuBak=J.onContextMenu;J.onContextMenu=function(M,L){if(f.isFunction(H.onContextMenuBak)){H.onContextMenuBak.apply(this,arguments)}if(J.selectOnContextMenu){I.tree("select",L.target)}if(J.enableContextMenu){M.preventDefault();var K=b(I,J,M,L);if(J.autoBindDblClick&&J.dblClickMenuIndex>=0&&f.util.likeArray(J.contextMenu)&&!f.util.isString(J.contextMenu)&&J.contextMenu.length>J.dblClickMenuIndex){K[J.dblClickMenuIndex].bold=true}f.easyui.showMenu({items:K,left:M.pageX,top:M.pageY})}}}function s(I,J,H){if(!f.array.likeArray(J.contextMenu)||f.util.isString(J.contextMenu)||!J.contextMenu.length||!J.autoBindDblClick){return}J.onDblClickBak=J.onDblClick;J.onDblClick=function(N){if(f.isFunction(H.onDblClickBak)){H.onDblClickBak.apply(this,arguments)}var K=b(I,J,null,N);if(J.dblClickMenuIndex>=0&&K.length>J.dblClickMenuIndex){var M=K[J.dblClickMenuIndex],L=M.handler||M||onclick;L(null,N,I,M,null)}}}function b(N,Q,V,U){var T=Q.toggleMenu,S=Q.moveMenu;if(typeof T=="object"){T=f.extend({},{expand:true,expandAll:true,collapse:true,collapseAll:true,submenu:false},T)}if(typeof S=="object"){S=f.extend({},{up:false,upLevel:false,down:false,downLevel:false,submenu:false},S)}var O={text:"展开当前所有",iconCls:"icon-metro-expand",disabled:!(T==true||T.expandAll==true),handler:function(){N.tree("expandAll",U.target)}};var K={text:"展开当前",iconCls:"icon-metro-expand2",disabled:!(T==true||T.expand==true),handler:function(){N.tree("expand",U.target)}};var I={text:"折叠当前",iconCls:"icon-metro-contract2",disabled:!(T==true||T.collapse==true),handler:function(){N.tree("collapse",U.target)}};var R={text:"折叠当前所有",iconCls:"icon-metro-contract",disabled:!(T==true||T.collapseAll==true),handler:function(){N.tree("collapseAll",U.target)}};var L={text:"上移一级",iconCls:"icon-standard-arrow-up",disabled:!(S==true||S.upLevel==true),handler:function(){N.tree("shift",{point:"upLevel",target:U.target})}};var W={text:"上移",iconCls:"icon-standard-up",disabled:!(S==true||S.up==true),handler:function(){N.tree("shift",{point:"up",target:U.target})}};var Y={text:"下移",iconCls:"icon-standard-down",disabled:!(S==true||S.down==true),handler:function(){N.tree("shift",{point:"down",target:U.target})}};var J={text:"下移一级",iconCls:"icon-standard-arrow-down",disabled:!(S==true||S.downLevel==true),handler:function(){N.tree("shift",{point:"downLevel",target:U.target})}};var H={text:"显示 Option",iconCls:"icon-standard-application-form",disabled:!Q.showOption,children:[{text:"树控件 Option",iconCls:"icon-hamburg-category",handler:function(){N.tree("showOption")}},{text:"该节点 Option",iconCls:"tree-icon tree-file",handler:function(){N.tree("showOption",U.target)}}]};var P=[];var M=[O,K,I,R],X=[L,W,Y,J];if(N.tree("isRoot",U.target)){f.array.insertRange(M,0,[{text:"展开所有",iconCls:"icon-standard-arrow-out",handler:function(){N.tree("expandAll")}},{text:"折叠所有",iconCls:"icon-standard-arrow-in",handler:function(){N.tree("collapseAll")}},"-"])}if(f.array.likeArray(Q.contextMenu)){f.array.merge(P,Q.contextMenu,"-")}if(Q.showOption){f.array.merge(P,H,"-")}f.array.merge(P,typeof T=="object"&&!T.submenu?f.array.merge(M,"-"):[{text:"展开/折叠",iconCls:"",disabled:!T,children:M},"-"]);f.array.merge(P,typeof S=="object"&&!S.submenu?X:{text:"上/下移(级)",iconCls:"",disabled:!S,children:X});return y(V,U,P,N)}function y(K,I,J,H){return f.array.map(J,function(M){if(!M||f.util.isString(M)){return M}var L=f.extend({},M);L.id=f.isFunction(M.id)?M.id.call(L,K,I,H):M.id;L.text=f.isFunction(M.text)?M.text.call(L,K,I,H):M.text;L.iconCls=f.isFunction(M.iconCls)?M.iconCls.call(L,K,I,H):M.iconCls;L.disabled=f.isFunction(M.disabled)?M.disabled.call(L,K,I,H):M.disabled;L.hideOnClick=f.isFunction(M.hideOnClick)?M.hideOnClick.call(L,K,I,H):M.hideOnClick;L.onclick=f.isFunction(M.onclick)?function(O,N,P){M.onclick.call(this,O,I,H,N,P)}:M.onclick;L.handler=f.isFunction(M.handler)?function(O,N,P){M.handler.call(this,O,I,H,N,P)}:M.handler;if(L.children&&L.children.length){L.children=y(K,I,L.children,H)}return L})}var A=f.fn.tree.extensions.initExtensions=function(I,J){var H=J._extensions?J._extensions:J._extensions={};if(H._initialized){return}e(I,J,H);F(I,J,H);s(I,J,H);H._initialized=true};var w=f.fn.tree.extensions.parseQueryParams=function(I,J){var H=f.extend({},J,I.queryParams);return f.util.parseMapFunction(H)};var o=f.fn.tree.extensions.loader=function(L,K,H){var I=f(this),J=I.tree("options");A(I,J);if(!J.url){return false}L=w(J,L);f.ajax({type:J.method,url:J.url,data:L,dataType:"json",success:function(M){K(M)},error:function(){H.apply(this,arguments)}})};var r=f.fn.tree.defaults.onExpand;var j=f.fn.tree.extensions.onExpand=function(L){if(f.isFunction(r)){r.apply(this,arguments)}var J=f(this),K=J.tree("options");if(K.onlyNodeExpand){var I=J.tree("getNears",L.target),H=K.animate;K.animate=false;f.each(f.array.filter(I,function(M){return M.target!=L.target&&M.state=="open"}),function(){J.tree("collapse",this.target)});K.animate=H}};var i=f.fn.tree.defaults.loadFilter;var G=f.fn.tree.extensions.loadFilter=function(K,I){if(f.isFunction(i)){K=i.apply(this,arguments)}K=f.array.likeArray(K)&&!f.util.isString(K)?K:[];if(!K.length){return K}var H=f(this),J=H.tree("options");return J.dataPlain?f.fn.tree.extensions.dataPlainConverter(K,J):K};f.fn.tree.extensions.dataPlainConverter=function(M,L){M=M||[];var J=M,I=L.idField||"id",N=L.parentField||"pid";if(L.dataPlain){var H=f.array.filter(M,function(O){if(O[N]==null||O[N]==h){return true}return !f.array.some(M,function(P){return O[N]==P[I]})});var K=function(Q,O){var P=f.array.filter(Q,function(R){return R[N]==null||R[N]==h?false:R[N]==O[I]});return f.array.map(P,function(S){var R=K(Q,S);if(R.length){S.children=f.array.likeArray(S.children)&&!f.util.isString(S.children)?S.children:[];f.array.merge(S.children,R)}return S})};J=f.array.map(H,function(P){var O=K(M,P);if(O.length){P.children=f.array.likeArray(P.children)&&!f.util.isString(P.children)?P.children:[];f.array.merge(P.children,O)}return P})}return J};f.fn.tree.extensions.cascadeToArray=function(J){if(f.util.isEmptyObjectOrNull(J)){return[]}if(!f.util.likeArrayNotString(J)){J=[J]}var I=[],H=function(L){var K=f.extend({},L),M=[K];if(!K.children||(K.children&&!f.util.likeArrayNotString(K.children))){return M}f.each(K.children,function(N,O){f.array.merge(M,H(O))});K.children=h;return M};f.each(J,function(K,L){f.array.merge(I,H(L))});return I};var D=f.fn.tree.extensions.methods={isRoot:function(I,H){return x(I[0],H)},showOption:function(I,H){return I.each(function(){g(this,H)})},getLevel:function(I,H){return p(I[0],H)},move:function(I,H){return I.each(function(){t(this,H)})},shift:function(I,H){return I.each(function(){l(this,H)})},compare:function(I,H){return C(I[0],H)},isChild:function(I,H){return m(I[0],H)},isParent:function(I,H){return E(I[0],H)},isSibling:function(I,H){return B(I[0],H)},next:function(I,H){return c(I[0],H)},prev:function(I,H){return v(I[0],H)},getNears:function(I,H){return k(I[0],H)},getNearChildren:function(I,H){return u(I[0],H)},unselect:function(I,H){return I.each(function(){q(this,H)})},load:function(I,H){return I.each(function(){d(this,H)})},setIcon:function(I,H){return I.each(function(){a(this,H)})},setText:function(I,H){return I.each(function(){z(this,H)})}};var n=f.fn.tree.extensions.defaults={autoBindDblClick:true,dblClickMenuIndex:0,dataPlain:false,parentField:"pid",selectOnContextMenu:false,toggleOnClick:false,onlyNodeExpand:false,enableContextMenu:true,contextMenu:null,toggleMenu:true,moveMenu:false,showOption:false,queryParams:{},loader:o,loadFilter:G,onExpand:j};f.extend(f.fn.tree.defaults,n);f.extend(f.fn.tree.methods,D)})(jQuery);